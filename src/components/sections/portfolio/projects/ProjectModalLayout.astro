---
const { id } = Astro.props;
---

<dialog id={id} class="p-0 border-none bg-transparent text-default">
  <!-- Fake backdrop -->
  <div class="fixed inset-0 bg-black/30 backdrop-blur-sm" data-dialog-backdrop>
  </div>

  <!-- Modal content -->
  <div
    class="relative z-10 bg-default p-6 max-w-xl mx-auto mt-40 rounded-xl shadow-xl"
    data-dialog-content
  >
    <slot />
  </div>
</dialog>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const openButtons = document.querySelectorAll("[data-dialog-open]");
    const closeButtons = document.querySelectorAll("[data-dialog-close]");

    openButtons.forEach((btn) => {
      btn.addEventListener("click", (e) => {
        e.preventDefault();
        const dialogId = btn.getAttribute("data-dialog-open");
        const dialog = document.getElementById(dialogId) as HTMLDialogElement;
        if (dialog && dialog.showModal) {
          dialog.showModal();
          //   document.body.classList.add("!overflow-hidden");

          const backdrop = dialog.querySelector("[data-dialog-backdrop]");
          const content = dialog.querySelector("[data-dialog-content]");

          if (backdrop) {
            backdrop.addEventListener("click", () => {
              dialog.close();
              //   document.body.classList.remove("!overflow-hidden");
            });
          }

          if (content) {
            content.addEventListener("click", (e) => e.stopPropagation());
          }
        }
      });
    });

    closeButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const dialog = btn.closest("dialog");
        if (dialog) {
          dialog.close();
          document.body.classList.remove("overflow-hidden");
        }
      });
    });
  });
</script>
